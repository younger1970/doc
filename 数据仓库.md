有用的博客：https://blog.csdn.net/mark_wu2000/article/details/82668787

数仓知识整理

# 1、数仓定义 

数据仓库 Data Warehouse，是为企业所决策制定过程，提供所有支持类型的数据集合。用于分析性报告和决策支持。数仓是一个**面向主题、集成的、相对稳定、反映历史变化的**数据集合，随着大数据技术的发展，其作用不再局限于决策分析、还可以为业务应用、审计、追踪溯源等多方面提供数据支撑，帮助企业完成数字化转型。

# 2、数据仓库特点

## 面向主题

普通的操作型数据库主要面向事务性处理，而数据仓库中的所有数据一般按照主题进行划分。主题是对业务数据的抽象，是从较高层次上对信息系统中的数据进行归纳和整理。

面向主题的数据可以划分成两部分

1. 根据原系统业务数据的特点进行主题的抽取。
2. 确定每个主题所包含的数据内容。例如客户主题、产品主题、财务主题等；而客户主题包括客户基本信息、客户信用信息、客户资源信息等内容。

分析数据仓库主题的时候，一般方法是先确定几个基本的主题，然后再将范围扩大，最后再逐步求精

## 集成性

面向操作型的数据库通常是异构的、并且相互独立，所以无法对信息进行概括和反映信息的本质。而数据仓库中的数据是经过数据的抽取、清洗、切换、加载得到的，所以为了保证数据不存在二义性，必须对数据进行编码统一和汇总，以保证数仓内的数据一致性，消除冗余数据。

## 稳定性

数据仓库中的数据反映的都是一段历史时期的数据内容，它的主要操作是查询、分析而不进行一般意义上的更新（操作型数据库主要完成数据的增加、修改、删除、查询），一旦某个数据进入到数据仓库后，一般情况下数据会被长期保留，超过规定的期限才会被删除。通常数据仓库需要做的工作就是加载、查询和分析，一般不进行修改操作。

## 反映历史变化

数据仓库不断从操作型数据库或其他数据源获取变化的数据，从而分析和预测需要的历史数据，所以一般数据仓库中数据表的维度与事实表中都含有时间键，以表明数据的历史时期信息，然后不断增加新的数据内容。通过这些历史信息可以对企业的发展历程和趋势做出分析和预测。数据仓库的建设需要大量的业务数据作为积累，并将这些宝贵的历史信息经过加工、整理，最后提供给决策分析人员，这是数据仓库建设的根本目的。

# 3、数据库和数据仓库的区别

**数据库**用于OLTP，主要用于操作型处理 数据库是面向事物处理的，数据是由日常的业务产生的，常更新；数据库一般用来存储当前事务性数据，如交易数据、业务数据；数据库的设计一般是符合三范式的，有最大的精确度和最小的冗余度，有利于数据的插入；

**数据仓库**用于OLAP，支持管理决策。数据仓库是面向主题的，数据来源多样，经过一定的规则转换得到，用来分析。数据仓库一般存储历史数据。数据仓库的设计一般不符合三范式，并且反规划范，有利于查询。

# 4、数仓构建流程

![图片](https://mmbiz.qpic.cn/mmbiz_png/GTdQ9xoSumWSv6yqptMl46KwE98lLf8kvVHe12Bu66sXicjmmMnlVN4jtQ1KbOdCGZmricQlEib1OuxdibMzRkS83g/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

## 1) 数据调研、划分主题域

通过与业务部门的交流，了解建立数仓要解决的问题，确定数据分析或前端展现的主题和各个主题下的查询分析要求。主题要体现出某一方面的各分析角度(维度)和统计数值型数据(量度)之间的关系。

## 2) 明确统计指标

确定主题后，需要考虑分析的各种指标。它们一般为数据值型数据，量度是要统计的指标，必须事先选择恰当，基于不同的度量可以进行复杂关键性指标(KPI)的设计和计算。

## 3) 构建总线矩阵

明确业务过程和维度所属主题域、明确维度与业务过程的关系，最后形成一个总线矩阵图表。![图片](https://mmbiz.qpic.cn/mmbiz_png/GTdQ9xoSumWSv6yqptMl46KwE98lLf8k5Kor5ka1WNwt484f7sqBQ9xt8C6bBG8DxC5Hicoa58c3YzMzBBe1A0g/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

## 4) 构建明细模型

DIM公共维度层 （DIM）公共维度层由维度表构成，基于维度建模理念，建立整个企业的一致性维度。维度是逻辑概念，是衡量和观察业务的角度。在划分数据域、构建总线矩阵时，需要结合对业务过程的分析定义维度。

构建明细事实表DWD，将原始数据表和各个维度表进行关联,生成事实表。

## 5) 构建汇总模型

根据衍生指标和派生指标构建DWS

## 6) ETL以及代码实现

数据清洗转换和传输。业务系统中的数据加载到数据仓库之前，必须进行数据的清洗和转换，保证数据仓库中数据的一致性。

## 7) 数仓应用、结果验证

开发数据仓库的分析应用。满足业务部门对数据进行分析的需求。

## 8) 数仓管理

元数据治理、数据质量监控、数据血缘管理

# 5、数仓分层概述

ods：operation data store原始数据层， 数据保持原貌不做处理，ODS层是数据仓库准备区，为DWD层提供基础原始数据，可减少对业务系统的影响

dmi：公共维度层 公共维度层由维度表构成，基于维度建模理念，建立整个企业的一致性维度。

dwd：data warehouse detail明细数据层 结构和粒度与原始表保持一致，通过维表与ods层数据进行清洗关联得到（去除空值，脏数据） 是业务层与数据仓库的隔离层

dws：data warehouse service数据服务层 数据轻度汇总。基于dwd上的基础数据，整合汇总成分析某一个主题域的服务数据，一般是宽表

ads：application data store 数据应用层 为各种统计报表提供数据 该层主要是提供数据产品和数据分析使用的数据，一般会存放在ES、MySQL等系统中供线上系统使用，也可能会存在Hive或者Druid中供数据分析和数据挖掘使用。例如：我们经常说的报表数据，或者说那种大宽表，一般就放在这里。